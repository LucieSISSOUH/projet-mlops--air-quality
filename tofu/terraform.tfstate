{"version":4,"terraform_version":"1.10.7","serial":25,"lineage":"ea8c72eb-137d-8485-49f7-b5d3757f843e","outputs":{"api_ip":{"value":"35.180.29.20","type":"string"},"api_url":{"value":"http://35.180.29.20:8000","type":"string"},"grafana_url":{"value":"http://35.181.152.214:3000","type":"string"},"monitoring_ip":{"value":"35.181.152.214","type":"string"}},"resources":[{"mode":"data","type":"aws_ami","name":"ubuntu","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"architecture":"x86_64","arn":"arn:aws:ec2:eu-west-3::image/ami-08062446029b25a4e","block_device_mappings":[{"device_name":"/dev/sda1","ebs":{"delete_on_termination":"true","encrypted":"false","iops":"0","snapshot_id":"snap-09105bec82105d332","throughput":"0","volume_initialization_rate":"0","volume_size":"8","volume_type":"gp2"},"no_device":"","virtual_name":""},{"device_name":"/dev/sdb","ebs":{},"no_device":"","virtual_name":"ephemeral0"},{"device_name":"/dev/sdc","ebs":{},"no_device":"","virtual_name":"ephemeral1"}],"boot_mode":"uefi-preferred","creation_date":"2025-11-22T06:49:11.000Z","deprecation_time":"2027-11-22T06:49:11.000Z","description":"Canonical, Ubuntu, 22.04, amd64 jammy image","ena_support":true,"executable_users":null,"filter":[{"name":"name","values":["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]},{"name":"virtualization-type","values":["hvm"]}],"hypervisor":"xen","id":"ami-08062446029b25a4e","image_id":"ami-08062446029b25a4e","image_location":"amazon/ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-20251122","image_owner_alias":"amazon","image_type":"machine","imds_support":"","include_deprecated":false,"kernel_id":"","last_launched_time":"","most_recent":true,"name":"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-20251122","name_regex":null,"owner_id":"099720109477","owners":["099720109477"],"platform":"","platform_details":"Linux/UNIX","product_codes":[],"public":true,"ramdisk_id":"","root_device_name":"/dev/sda1","root_device_type":"ebs","root_snapshot_id":"snap-09105bec82105d332","sriov_net_support":"simple","state":"available","state_reason":{"code":"UNSET","message":"UNSET"},"tags":{},"timeouts":null,"tpm_support":"","uefi_data":null,"usage_operation":"RunInstances","virtualization_type":"hvm"},"sensitive_attributes":[]}]},{"mode":"data","type":"local_file","name":"public_key","provider":"provider[\"registry.opentofu.org/hashicorp/local\"]","instances":[{"schema_version":0,"attributes":{"content":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDBrVK4FgHZj1QeNvpDVBHSNHdgfN5Q42OpeH7bIMF/X1OV8VnJXP5E9ZTYqjH1j0QPLNSR8ZLigCANObP40NsJsiDYW45p3nf8COFym4kF6AJ7qjK/nZhkzIW7dMMx9WRJwcd2StTExYEbkwEAiiUs2oVrcjyP9AHzMzzq2iPYikbvzpRB/x/i9eODybGY61TrM4aRd5t0MIrYUtaLD6WDtBkGGpp2ycphZQOdn5/2+MV7LM/4Uo7tI3s7oj9R2fYQbPzOl+4doBqKYMiw/WJEfRSi3K8MCWru2E2l+/DqR0G1C5aD2WvXONxn2yM2sCJHPUUk2MuRJwJscPCFrJ9\r\n","content_base64":"c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFEREJyVks0RmdIWmoxUWVOdnBEVkJIU05IZGdmTjVRNDJPcGVIN2JJTUYvWDFPVjhWbkpYUDVFOVpUWXFqSDFqMFFQTE5TUjhaTGlnQ0FOT2JQNDBOc0pzaURZVzQ1cDNuZjhDT0Z5bTRrRjZBSjdxaksvblpoa3pJVzdkTU14OVdSSndjZDJTdFRFeFlFYmt3RUFpaVVzMm9WcmNqeVA5QUh6TXp6cTJpUFlpa2J2enBSQi94L2k5ZU9EeWJHWTYxVHJNNGFSZDV0ME1JcllVdGFMRDZXRHRCa0dHcHAyeWNwaFpRT2RuNS8yK01WN0xNLzRVbzd0STNzN29qOVIyZllRYlB6T2wrNGRvQnFLWU1pdy9XSkVmUlNpM0s4TUNXcnUyRTJsKy9EcVIwRzFDNWFEMld2WE9OeG4yeU0yc0NKSFBVVWsyTXVSSndKc2NQQ0ZySjkNCg==","content_base64sha256":"7e8CBWzghNPnnlFmMfIQAspdgiUUrxZNScKED7Q6OXI=","content_base64sha512":"nGjhxH0ejsqNokFf9F8svwfILzJNtiSJF8nzWtGQL61mxBaspM/d8lg2f+74ymcBkiR1D0pF1YPuwVHWKNje0w==","content_md5":"50c80a11644d2a1beb557ecf4fe70d54","content_sha1":"58bdc1dd3203fddac3c4608bde0cb0739bbb2015","content_sha256":"edef02056ce084d3e79e516631f21002ca5d822514af164d49c2840fb43a3972","content_sha512":"9c68e1c47d1e8eca8da2415ff45f2cbf07c82f324db6248917c9f35ad1902fad66c416aca4cfddf258367feef8ca67019224750f4a45d583eec151d628d8ded3","filename":"C:\\Users\\synty\\.ssh\\myKeyML.pub","id":"58bdc1dd3203fddac3c4608bde0cb0739bbb2015"},"sensitive_attributes":[]}]},{"mode":"managed","type":"aws_instance","name":"api_instance","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":1,"attributes":{"ami":"ami-08062446029b25a4e","arn":"arn:aws:ec2:eu-west-3:135138487833:instance/i-0ad77ecbe42c5aa27","associate_public_ip_address":true,"availability_zone":"eu-west-3c","capacity_reservation_specification":[{"capacity_reservation_preference":"open","capacity_reservation_target":[]}],"cpu_core_count":1,"cpu_options":[{"amd_sev_snp":"","core_count":1,"threads_per_core":2}],"cpu_threads_per_core":2,"credit_specification":[{"cpu_credits":"unlimited"}],"disable_api_stop":false,"disable_api_termination":false,"ebs_block_device":[],"ebs_optimized":false,"enable_primary_ipv6":null,"enclave_options":[{"enabled":false}],"ephemeral_block_device":[],"get_password_data":false,"hibernation":false,"host_id":"","host_resource_group_arn":null,"iam_instance_profile":"","id":"i-0ad77ecbe42c5aa27","instance_initiated_shutdown_behavior":"stop","instance_lifecycle":"","instance_market_options":[],"instance_state":"running","instance_type":"t3.micro","ipv6_address_count":0,"ipv6_addresses":[],"key_name":"myKeyMLOps","launch_template":[],"maintenance_options":[{"auto_recovery":"default"}],"metadata_options":[{"http_endpoint":"enabled","http_protocol_ipv6":"disabled","http_put_response_hop_limit":1,"http_tokens":"optional","instance_metadata_tags":"disabled"}],"monitoring":false,"network_interface":[],"outpost_arn":"","password_data":"","placement_group":"","placement_partition_number":0,"primary_network_interface_id":"eni-09b6708770ad0c1f7","private_dns":"ip-172-31-40-12.eu-west-3.compute.internal","private_dns_name_options":[{"enable_resource_name_dns_a_record":false,"enable_resource_name_dns_aaaa_record":false,"hostname_type":"ip-name"}],"private_ip":"172.31.40.12","public_dns":"ec2-35-180-29-20.eu-west-3.compute.amazonaws.com","public_ip":"35.180.29.20","root_block_device":[{"delete_on_termination":true,"device_name":"/dev/sda1","encrypted":false,"iops":100,"kms_key_id":"","tags":{},"tags_all":{},"throughput":0,"volume_id":"vol-0c9f6968311addbb3","volume_size":8,"volume_type":"gp2"}],"secondary_private_ips":[],"security_groups":["mlops-api-sg"],"source_dest_check":true,"spot_instance_request_id":"","subnet_id":"subnet-04b90a4c31b285ccf","tags":{"Name":"MLOps-API-Instance"},"tags_all":{"Name":"MLOps-API-Instance"},"tenancy":"default","timeouts":null,"user_data":null,"user_data_base64":null,"user_data_replace_on_change":false,"volume_tags":null,"vpc_security_group_ids":["sg-09662d53c638058ac"]},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9","dependencies":["aws_key_pair.mlops_keypair","aws_security_group.sg_api","data.aws_ami.ubuntu","data.local_file.public_key"]}]},{"mode":"managed","type":"aws_instance","name":"monitoring_instance","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":1,"attributes":{"ami":"ami-08062446029b25a4e","arn":"arn:aws:ec2:eu-west-3:135138487833:instance/i-019b14346678828c5","associate_public_ip_address":true,"availability_zone":"eu-west-3c","capacity_reservation_specification":[{"capacity_reservation_preference":"open","capacity_reservation_target":[]}],"cpu_core_count":1,"cpu_options":[{"amd_sev_snp":"","core_count":1,"threads_per_core":2}],"cpu_threads_per_core":2,"credit_specification":[{"cpu_credits":"unlimited"}],"disable_api_stop":false,"disable_api_termination":false,"ebs_block_device":[],"ebs_optimized":false,"enable_primary_ipv6":null,"enclave_options":[{"enabled":false}],"ephemeral_block_device":[],"get_password_data":false,"hibernation":false,"host_id":"","host_resource_group_arn":null,"iam_instance_profile":"","id":"i-019b14346678828c5","instance_initiated_shutdown_behavior":"stop","instance_lifecycle":"","instance_market_options":[],"instance_state":"running","instance_type":"t3.micro","ipv6_address_count":0,"ipv6_addresses":[],"key_name":"myKeyMLOps","launch_template":[],"maintenance_options":[{"auto_recovery":"default"}],"metadata_options":[{"http_endpoint":"enabled","http_protocol_ipv6":"disabled","http_put_response_hop_limit":1,"http_tokens":"optional","instance_metadata_tags":"disabled"}],"monitoring":false,"network_interface":[],"outpost_arn":"","password_data":"","placement_group":"","placement_partition_number":0,"primary_network_interface_id":"eni-00eb745897e947af0","private_dns":"ip-172-31-45-66.eu-west-3.compute.internal","private_dns_name_options":[{"enable_resource_name_dns_a_record":false,"enable_resource_name_dns_aaaa_record":false,"hostname_type":"ip-name"}],"private_ip":"172.31.45.66","public_dns":"ec2-35-181-152-214.eu-west-3.compute.amazonaws.com","public_ip":"35.181.152.214","root_block_device":[{"delete_on_termination":true,"device_name":"/dev/sda1","encrypted":false,"iops":100,"kms_key_id":"","tags":{},"tags_all":{},"throughput":0,"volume_id":"vol-023045743ed624c36","volume_size":8,"volume_type":"gp2"}],"secondary_private_ips":[],"security_groups":["mlops-monitoring-sg"],"source_dest_check":true,"spot_instance_request_id":"","subnet_id":"subnet-04b90a4c31b285ccf","tags":{"Name":"MLOps-Monitoring-Instance"},"tags_all":{"Name":"MLOps-Monitoring-Instance"},"tenancy":"default","timeouts":null,"user_data":null,"user_data_base64":null,"user_data_replace_on_change":false,"volume_tags":null,"vpc_security_group_ids":["sg-08fbdccf489264411"]},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9","dependencies":["aws_key_pair.mlops_keypair","aws_security_group.sg_monitoring","data.aws_ami.ubuntu","data.local_file.public_key"]}]},{"mode":"managed","type":"aws_key_pair","name":"mlops_keypair","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":1,"attributes":{"arn":"arn:aws:ec2:eu-west-3:135138487833:key-pair/myKeyMLOps","fingerprint":"27:9f:67:04:fb:df:9b:a7:62:85:bb:3c:ea:bc:73:1c","id":"myKeyMLOps","key_name":"myKeyMLOps","key_name_prefix":"","key_pair_id":"key-0b7a5086dc06a0494","key_type":"rsa","public_key":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDBrVK4FgHZj1QeNvpDVBHSNHdgfN5Q42OpeH7bIMF/X1OV8VnJXP5E9ZTYqjH1j0QPLNSR8ZLigCANObP40NsJsiDYW45p3nf8COFym4kF6AJ7qjK/nZhkzIW7dMMx9WRJwcd2StTExYEbkwEAiiUs2oVrcjyP9AHzMzzq2iPYikbvzpRB/x/i9eODybGY61TrM4aRd5t0MIrYUtaLD6WDtBkGGpp2ycphZQOdn5/2+MV7LM/4Uo7tI3s7oj9R2fYQbPzOl+4doBqKYMiw/WJEfRSi3K8MCWru2E2l+/DqR0G1C5aD2WvXONxn2yM2sCJHPUUk2MuRJwJscPCFrJ9","tags":{},"tags_all":{}},"sensitive_attributes":[],"private":"eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==","dependencies":["data.local_file.public_key"]}]},{"mode":"managed","type":"aws_security_group","name":"sg_api","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":1,"attributes":{"arn":"arn:aws:ec2:eu-west-3:135138487833:security-group/sg-09662d53c638058ac","description":"Allow SSH, API (port 8000) and Metrics (port 9090) access","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"id":"sg-09662d53c638058ac","ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Acces SSH","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":["0.0.0.0/0"],"description":"Acces public a l API MLOps","from_port":8000,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":8000},{"cidr_blocks":["46.193.64.220/32"],"description":"Acces aux metriques 9090 depuis monitoring","from_port":9090,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":9090}],"name":"mlops-api-sg","name_prefix":"","owner_id":"135138487833","revoke_rules_on_delete":false,"tags":{},"tags_all":{},"timeouts":null,"vpc_id":"vpc-0af4640a30a7409b1"},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="}]},{"mode":"managed","type":"aws_security_group","name":"sg_monitoring","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":1,"attributes":{"arn":"arn:aws:ec2:eu-west-3:135138487833:security-group/sg-08fbdccf489264411","description":"Allow SSH and Grafana access","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"id":"sg-08fbdccf489264411","ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Acces SSH","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":["0.0.0.0/0"],"description":"Acces a l interface Grafana","from_port":3000,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":3000}],"name":"mlops-monitoring-sg","name_prefix":"","owner_id":"135138487833","revoke_rules_on_delete":false,"tags":{},"tags_all":{},"timeouts":null,"vpc_id":"vpc-0af4640a30a7409b1"},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="}]},{"mode":"managed","type":"local_file","name":"ansible_inventory","provider":"provider[\"registry.opentofu.org/hashicorp/local\"]","instances":[{"schema_version":0,"attributes":{"content":"// tofu/templates/inventory.tpl\r\n\r\nall:\r\n  vars:\r\n    ansible_user: ubuntu\r\n    # Ansible a besoin de la clé PRIVÉE (myKeyML.pem) pour se connecter aux instances EC2.\r\n    ansible_ssh_private_key_file: C:\\Users\\synty\\.ssh\\myKeyML.pem\r\n    # Mot de passe pour la configuration initiale de Grafana (lu depuis variables.tf)\r\n    grafana_password: admin123 \r\n  children:\r\n    # Groupe pour l'instance API\r\n    api_group:\r\n      hosts:\r\n        api_host:\r\n          # IP de l'instance API fournie par OpenTofu\r\n          ansible_host: 35.180.29.20 \r\n          api_port: 8000\r\n    \r\n    # Groupe pour l'instance Monitoring\r\n    monitoring_group:\r\n      hosts:\r\n        monitoring_host:\r\n          # IP de l'instance Monitoring fournie par OpenTofu\r\n          ansible_host: 35.181.152.214\r\n          grafana_port: 3000\r\n          # URL complète de l'API cible pour la configuration de Prometheus par Ansible\r\n          api_target: http://35.180.29.20:8000","content_base64":null,"content_base64sha256":"yIXePqJc6jZOa/NgUcjQ5MLXy8+73mKiB+4QsNpvxj0=","content_base64sha512":"ycVnb0wCFM9TH1Feoy6dMfd85gqNo5hecgDhIDqgUqZpbBEFQvlezNKYPieIfHA8z+NGEhN2Y7np0wJpHkXXow==","content_md5":"d39b95ef010f7cd7870eff1ee22ac411","content_sha1":"52b10f721481e739c9eeb3465a43ab460c89e04f","content_sha256":"c885de3ea25cea364e6bf36051c8d0e4c2d7cbcfbbde62a207ee10b0da6fc63d","content_sha512":"c9c5676f4c0214cf531f515ea32e9d31f77ce60a8da3985e7200e1203aa052a6696c110542f95eccd2983e27887c703ccfe34612137663b9e9d302691e45d7a3","directory_permission":"0777","file_permission":"0777","filename":"../ansible/inventory.yml","id":"52b10f721481e739c9eeb3465a43ab460c89e04f","sensitive_content":null,"source":null},"sensitive_attributes":[[{"type":"get_attr","value":"sensitive_content"}]],"dependencies":["aws_instance.api_instance","aws_instance.monitoring_instance","aws_key_pair.mlops_keypair","aws_security_group.sg_api","aws_security_group.sg_monitoring","data.aws_ami.ubuntu","data.local_file.public_key"]}]}],"check_results":null}
